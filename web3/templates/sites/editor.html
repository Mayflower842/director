{% extends "base.html" %}
{% load staticfiles %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.4.2/jquery.contextMenu.min.css" />

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/golden-layout/1.5.7/css/goldenlayout-base.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/golden-layout/1.5.7/css/goldenlayout-light-theme.css" />

    {% if site.database %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/sql_console.css' %}" />
    {% endif %}

    <link rel="stylesheet" href="{% static 'css/terminal/xterm.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'css/terminal/terminal.css' %}" type="text/css" />

    <link rel="stylesheet" type="text/css" href="{% static 'css/site_editor.css' %}" />
{% endblock %}

{% block js %}
    {{ block.super }}
    <script type="text/javascript" src="{% static 'js/terminal/xterm.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/terminal/fit.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/terminal/terminal.js' %}"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ext-modelist.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ext-language_tools.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/golden-layout/1.5.7/goldenlayout.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.4.2/jquery.ui.position.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.4.2/jquery.contextMenu.min.js"></script>

    <script type="text/javascript" src="{% static 'js/sites/editor.js' %}"></script>
    <script type="text/javascript">
    var site_url = "{{ site.url }}";
    var site_name = "{{ site.name }}";
    var path_endpoint = "{% url 'editor_path' site.id %}";
    var load_endpoint = "{% url 'editor_load' site.id %}";
    var save_endpoint = "{% url 'editor_save' site.id %}";
    var delete_endpoint = "{% url 'editor_delete' site.id %}";
    var create_endpoint = "{% url 'editor_create' site.id %}";
    var download_endpoint = "{% url 'editor_download' site.id %}";
    var rename_endpoint = "{% url 'editor_rename' site.id %}";
    var upload_endpoint = "{% url 'editor_upload' site.id %}";
    var move_endpoint = "{% url 'editor_move' site.id %}";
    var process_endpoint = "{% url 'editor_process' site.id %}";
    var exec_endpoint = "{% url 'editor_exec' site.id %}";
    var nginx_endpoint = "{% url 'edit_nginx' site.id %}";
    var is_dynamic = {% if site.category == 'dynamic' %}true{% else %}false{% endif %};
    var terminal_auth = { uid: "{{ request.user.id }}", token: "{{ request.user.access_token }}", site: "{{ site.id }}" };
    </script>
    {% include "ajax_csrf.html" %}
    {% if site.database %}
    <script type="text/javascript">
    var sql_endpoint = "{% url 'sql_database' site.id %}";
    </script>
    <script type="text/javascript" src="{% static 'js/sql_console.js' %}"></script>
    {% endif %}
{% endblock %}

{% block navbar %}
<a href="{% url 'info_site' site.id %}">{{ site.name }}</a>
{% endblock %}

{% block main %}
<div id="editor-container"></div>
<iframe id="download" style="display:none"></iframe>
{% if site.database %}
<div id="sql-console-template" style="display:none">
    <div class="sql-console">
        <pre class="output"><b>database: {{ site.database.db_name }}, user: {{ site.database.username }}, type: {{ site.database.category }}</b>
    </pre>
        <table><tr><td class="ps">{{ site.database.db_name }}=&gt; </td><td class="input-td"><input autofocus class="input" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" /></td></tr></table>
    </div>
</div>
{% endif %}
<div id="console-wrapper-template" style="display:none">
    <div class="console-wrapper" tabindex="0">
        <div class="console"></div>
        <div class="disconnect">
            <b>Connection Lost</b>, press <kbd>ENTER</kbd> to reconnect
        </div>
    </div>
</div>
{% endblock %}
