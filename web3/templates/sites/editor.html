{% extends "base.html" %}
{% load staticfiles %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.4.1/jquery.contextMenu.min.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" />
    {% if site.database %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/sql_console.css' %}" />
    {% endif %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/site_editor.css' %}" />
{% endblock %}

{% block js %}
    {{ block.super }}
    <script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ext-modelist.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.4.1/jquery.contextMenu.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script type="text/javascript" src="{% static 'js/sites/editor.js' %}"></script>
    <script type="text/javascript">
    var site_url = "{{ site.url }}";
    var path_endpoint = "{% url 'editor_path' site.id %}";
    var load_endpoint = "{% url 'editor_load' site.id %}";
    var save_endpoint = "{% url 'editor_save' site.id %}";
    var delete_endpoint = "{% url 'editor_delete' site.id %}";
    var create_endpoint = "{% url 'editor_create' site.id %}";
    var download_endpoint = "{% url 'editor_download' site.id %}";
    var rename_endpoint = "{% url 'editor_rename' site.id %}";
    var upload_endpoint = "{% url 'editor_upload' site.id %}";
    var move_endpoint = "{% url 'editor_move' site.id %}";
    var process_endpoint = "{% url 'editor_process' site.id %}";
    var exec_endpoint = "{% url 'editor_exec' site.id %}";
    var nginx_endpoint = "{% url 'edit_nginx' site.id %}";
    var is_dynamic = {% if site.category == 'dynamic' %}true{% else %}false{% endif %};
    var csrftoken = "{{ csrf_token }}";
    var terminal_url = "/ws/terminal.html?uid={{ request.user.id }}&token={{ request.user.access_token }}&site={{ site.id }}";
    function csrfSafeMethod(method) {
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });
    </script>
    {% if site.database %}
    <script type="text/javascript" src="{% static 'js/sql_console.js' %}"></script>
    <script type="text/javascript">
    var sql_endpoint = "{% url 'sql_database' site.id %}";
    </script>
    {% endif %}
{% endblock %}

{% block navbar %}
<a href="{% url 'info_site' site.id %}">{{ site.name }}</a>
{% endblock %}

{% block main %}
<div id="files"></div>
<div id="editor-wrapper">
    <div id="tabs">
        <div class="tab active tab-special tab-help"><i class="fa fa-question-circle"></i></div>
        <div class="tab tab-special tab-terminal pull-right"><i class="fa fa-terminal"></i></div>
        {% if site.database %}
        <div class="tab tab-special tab-console pull-right"><i class="fa fa-database"></i></div>
        {% endif %}
        {% if site.custom_nginx %}
        <div class="tab tab-special tab-nginx pull-right"><i class="fa fa-cog"></i> Nginx</div>
        {% endif %}
    </div>
    <div id="terminal" class="tab-pane"></div>
    <div id="editor" class="tab-pane"></div>
    {% if site.database %}
    <div id="sql-console" class="tab-pane">
        <div id="console">
            <pre class="output"><b>database: {{ site.database.db_name }}, user: {{ site.database.username }}, type: {{ site.database.category }}</b>
        </pre>
            <table><tr><td class="ps">{{ site.database.db_name }}=&gt; </td><td class="input-td"><input autofocus class="input" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" /></td></tr></table>
        </div>
    </div>
    {% endif %}
    <div id="image" class="tab-pane"><img /></div>
    <div id="embed" class="tab-pane"></div>
</div>
<iframe id="download" style="display:none"></iframe>
{% endblock %}
